<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소득조사 대시보드</title>
    
    <!-- 외부 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- CSS 파일 -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- 웹폰트 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <img src="https://raw.githubusercontent.com/soonpark2/project1/main/강원특별자치도농업기술원1.png" alt="회사 로고" class="logo" onclick="showTab('home', event)" style="cursor: pointer;">
            <div class="header-title" onclick="showTab('home', event)" style="cursor: pointer;">소득조사 대시보드</div>
        </div>
        <div class="header-right">
            <button class="tab-btn" onclick="showTab('summary', event)">요약</button>
            <button class="tab-btn" onclick="showTab('status', event)">작목별 조회</button>
            <button class="tab-btn" onclick="showTab('compare', event)">전국 vs 강원</button>
            <button class="tab-btn" onclick="showTab('yearly', event)">평년</button>
        </div>
    </div>

    <!-- 홈 탭 -->
    <div id="home" class="tab-content active">
        <div class="welcome-container">
            <div class="welcome-header">
                <h1>소득조사 분석 시스템</h1>
                <p class="welcome-subtitle">농업 소득 데이터를 한눈에 분석하고 관리하세요</p>
            </div>
            
            <div class="features-grid">
                <div class="feature-card" onclick="showTab('summary')">
                    <h3>요약</h3>
                    <p>농업 소득 데이터의 종합적인 요약 정보와 핵심 지표들을 한눈에 확인할 수 있습니다.</p>
                </div>
                
                <div class="feature-card" onclick="showTab('status')">
                    <h3>작목별 조회</h3>
                    <p>작목별 소득 현황을 상세하게 분석하고 경영비 구성을 파악할 수 있습니다.</p>
                </div>
                
                <div class="feature-card" onclick="showTab('compare')">
                    <h3>전국 vs 강원</h3>
                    <p>전국과 강원의 소득 격차를 비교 분석하여 특성을 파악합니다.</p>
                </div>
                
                <div class="feature-card" onclick="showTab('yearly')">
                    <h3>평년</h3>
                    <p>평년과 최신 소득자료를 전국·강원 단위로 비교 분석합니다.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 요약 탭 -->
    <div id="summary" class="tab-content">
        <!-- 필터 헤더 영역 -->
        <div class="summary-filters-header">
            <div class="summary-filter-group">
                <label class="summary-filter-label">지역구분:</label>
                <div class="summary-filter-buttons" id="summaryRegionFilter">
                    <button class="summary-filter-btn" data-region="강원">강원</button>
                    <button class="summary-filter-btn" data-region="전국">전국</button>
                </div>
            </div>
            <div class="summary-filter-group">
                <label class="summary-filter-label">년:</label>
                <div class="summary-filter-buttons" id="summaryYearFilter">
                </div>
            </div>
        </div>

        <!-- 3x3 그리드 레이아웃 -->
        <div class="summary-grid">
            <!-- 1열 1행: 소득 TOP 5 -->
            <div class="grid-item top5-card">
                <div class="card-header">
                    <h3 class="card-title">소득 TOP 5</h3>
                </div>
                <div class="card-content">
                    <div class="top5-list" id="incomeTop5List">
                        <div class="loading-item">데이터 로딩 중...</div>
                    </div>
                </div>
            </div>

            <!-- 2열 1행: 노동생산성 TOP 5 -->
            <div class="grid-item top5-card">
                <div class="card-header">
                    <h3 class="card-title">노동생산성 TOP 5</h3>
                </div>
                <div class="card-content">
                    <div class="top5-list" id="laborTop5List">
                        <div class="loading-item">데이터 로딩 중...</div>
                    </div>
                </div>
            </div>

            <!-- 3열 1-3행: 상세 데이터 표 (rowspan=3) -->
            <div class="grid-item data-table-area">
                <div class="table-header">
                    <h2 class="table-title">상세 조회<button onclick="exportSummaryTableToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button></h2>
                    <div class="table-filters">
                        <select id="cropGroupFilter" class="table-filter-select">
                            <option value="all">전체 작목군</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table class="summary-data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="crop">작목 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="income">소득 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="incomeRank">소득순위 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="laborProductivity">노동생산성 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="laborRank">노동순위 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="capitalProductivity">자본생산성 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="capitalRank">자본순위 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="landProductivity">kg당 생산비 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="landRank">kg당순위 <span class="sort-arrow"></span></th>
                            </tr>
                        </thead>
                        <tbody id="summaryTableBody">
                            <tr>
                                <td colspan="9" class="loading-cell">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 1열 2행: 자본생산성 TOP 5 -->
            <div class="grid-item top5-card">
                <div class="card-header">
                    <h3 class="card-title">자본생산성 TOP 5</h3>
                </div>
                <div class="card-content">
                    <div class="top5-list" id="capitalTop5List">
                        <div class="loading-item">데이터 로딩 중...</div>
                    </div>
                </div>
            </div>

            <!-- 2열 2행: kg당 생산비 TOP 5 -->
            <div class="grid-item top5-card">
                <div class="card-header">
                    <h3 class="card-title">kg당 생산비 TOP5(저비용)</h3>
                </div>
                <div class="card-content">
                    <div class="top5-list" id="landTop5List">
                        <div class="loading-item">데이터 로딩 중...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 작목별 조회 탭 -->
    <div id="status" class="tab-content">
        <div class="container">
            <!-- 모바일용 토글 버튼 -->
            <button class="mobile-toggle-btn" onclick="toggleSidebar()">필터 ▼</button>
            
            <!-- 필터 사이드바 -->
            <div class="sidebar" id="sidebar">
                <div class="filter-section">
                    <div class="filter-title">
                        지역구분
                    </div>
                    <div class="filter-content" id="regionFilter">
                        <div class="filter-item active" data-region="전국">전국</div>
                    </div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        년
                    </div>
                    <div class="year-buttons" id="yearFilter"></div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        작목군
                    </div>
                    <div class="filter-content" id="statusCropGroupFilter"></div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        작목상세
                    </div>
                    <div class="filter-content" id="cropFilter"></div>
                </div>
            </div>

            <!-- 차트 카드들 -->
            <div class="chart-card income-analysis-section">
                <div class="chart-title" id="summaryTitle">2023년 전국 소득분석표<button onclick="exportStatusAnalysisToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button></div>
                <div class="income-analysis-layout">
                    <div class="main-summary-box">
                        <div class="summary-item">
                            <span class="summary-label">소득</span>
                            <span id="totalIncome">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">소득률</span>
                            <span id="totalRate">0%</span>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>구분</th>
                                    <th>값</th>
                                </tr>
                            </thead>
                            <tbody id="detailTableBody">
                                <tr><td colspan="2" class="loading">데이터를 불러오는 중...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="chart-card total-income-chart">
                <div class="chart-title" id="combinedIncomeTitle">
                    총수입 및 경영비 추이
                </div>
                <div class="chart-container">
                    <canvas id="combinedIncomeChart"></canvas>
                </div>
            </div>

            <div class="chart-card income-rate-chart">
                <div class="chart-title" id="incomeRateTitle">
                    소득 및 소득률
                </div>
                <div class="chart-container">
                    <canvas id="incomeRateChart"></canvas>
                </div>
            </div>

            <div class="chart-card productivity-chart">
                <div class="chart-title-with-select">
                    <span id="productivityTitle">생산성 추이</span>
                    <select id="productivitySelector" class="chart-select">
                        <option value="labor">노동생산성</option>
                        <option value="capital">자본생산성</option>
                        <option value="land">토지생산성</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="productivityChart"></canvas>
                </div>
            </div>
            <div class="chart-card cost-efficiency-chart">
                <div class="chart-title-with-select">
                    <span id="costEfficiencyTitle">단위당 비용</span>
                    <select id="costEfficiencySelector" class="chart-select">
                        <option value="production">kg당 생산비</option>
                        <option value="management">kg당 경영비</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="costEfficiencyChart"></canvas>
                </div>
            </div>

            <div class="chart-card yield-price-chart">
                <div class="chart-title" id="yieldPriceTitle">
                    주산물수량 및 수취가격
                </div>
                <div class="chart-container">
                    <canvas id="yieldPriceChart"></canvas>
                </div>
            </div>

            <div class="chart-card annual-labor-chart">
                <div class="chart-title" id="annualLaborTitle">
                    연간 노동시간
                </div>
                <div class="chart-container">
                    <canvas id="annualLaborChart"></canvas>
                </div>
            </div>

        </div>
    </div>

    <!-- 전국 vs 강원 탭 -->
    <div id="compare" class="tab-content">
        <div class="container">
            <!-- 모바일용 토글 버튼 -->
            <button class="mobile-toggle-btn" onclick="toggleCompareSidebar()">필터 ▼</button>
            
            <!-- 필터 사이드바 (지역구분 제외) -->
            <div class="sidebar" id="compareSidebar">
                <div class="filter-section">
                    <div class="filter-title">
                        년
                    </div>
                    <div class="year-buttons" id="compareYearFilter"></div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        작목군
                    </div>
                    <div class="filter-content" id="compareCropGroupFilter"></div>
                </div>

                <div class="filter-section">
                    <div class="filter-title">
                        작목상세
                    </div>
                    <div class="filter-content" id="compareCropFilter"></div>
                </div>
            </div>

            <!-- 비교 분석표 -->
            <div class="chart-card income-analysis-section">
                <div class="chart-title" id="compareSummaryTitle">2023년 전국, 강원 소득비교표<button onclick="exportCompareAnalysisToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button></div>
                <div class="income-analysis-layout">
                    <div class="main-summary-box">
                        <div class="summary-item">
                            <span class="summary-label">전국소득</span>
                            <span id="compareNationalIncome">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">강원소득</span>
                            <span id="compareGangwonIncome">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">차이</span>
                            <span id="compareDifference">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">대비</span>
                            <span id="compareRatio">0%</span>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>구분</th>
                                    <th>전국</th>
                                    <th>강원</th>
                                    <th>차이</th>
                                    <th>대비(%)</th>
                                </tr>
                            </thead>
                            <tbody id="compareDetailTableBody">
                                <tr><td colspan="5" class="loading">데이터를 불러오는 중...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 비교 차트들 -->
            <div class="chart-card total-income-chart">
                <div class="chart-title-with-select">
                    <span id="compareDataTitle">전국, 강원 비교</span>
                    <select id="compareDataSelect" class="chart-select">
                        <option value="totalIncome">총수입</option>
                        <option value="income">소득</option>
                        <option value="incomeRate">소득률</option>
                        <option value="mainProductQuantity">주산물수량</option>
                        <option value="receivedPrice">수취가격</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="compareDataChart"></canvas>
                </div>
            </div>

            <div class="chart-card management-cost-chart">
                <div class="chart-title-with-select">
                    <span id="compareProductivityTitle">전국, 강원 생산성 비교</span>
                    <select id="compareProductivitySelect" class="chart-select">
                        <option value="laborProductivity">노동생산성</option>
                        <option value="capitalProductivity">자본생산성</option>
                        <option value="landProductivity">토지생산성</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="compareProductivityChart"></canvas>
                </div>
            </div>

            <div class="chart-card income-rate-chart">
                <div class="chart-title-with-select">
                    <span id="compareCostTitle">전국, 강원 비용 비교</span>
                    <select id="compareCostSelect" class="chart-select">
                        <option value="intermediateCost">중간재비</option>
                        <option value="managementCost">경영비</option>
                        <option value="productionCost">생산비</option>
                        <option value="managementCostPerKg">kg당 경영비</option>
                        <option value="costPerKg">kg당 생산비</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="compareCostChart"></canvas>
                </div>
            </div>


            <div class="chart-card annual-labor-chart">
                <div class="chart-title-with-select">
                    <span id="compareLaborTitle">전국, 강원 노동시간 비교</span>
                    <select id="compareLaborSelect" class="chart-select">
                        <option value="totalLaborTime">총노동시간</option>
                        <option value="selfLaborTime">자가노동시간</option>
                        <option value="hiredLaborTime">고용노동시간</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="compareLaborChart"></canvas>
                </div>
            </div>

            <div class="chart-card income-table">
                <div class="chart-title" id="compareCropIncomeTitle">
                    전국, 강원 전체 작목별 소득<button onclick="exportCompareIncomeTableToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>작목</th>
                                <th>전국</th>
                                <th>강원</th>
                                <th>차이</th>
                                <th>대비(%)</th>
                            </tr>
                        </thead>
                        <tbody id="compareCropIncomeTableBody">
                            <tr><td colspan="5" class="loading">데이터를 불러오는 중...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 평년 탭 -->
    <div id="yearly" class="tab-content">
        <!-- 필터 헤더 영역 -->
        <div class="yearly-filters-header">
            <div class="yearly-filter-group">
                <label class="yearly-filter-label">비교 모드:</label>
                <div class="yearly-filter-buttons" id="comparisonModeFilter">
                    <!-- 동적으로 생성 -->
                </div>
            </div>
            <div class="yearly-filter-group">
                <label class="yearly-filter-label">작목군:</label>
                <div class="yearly-filter-select-container">
                    <select id="yearlyCropGroupSelect" class="yearly-filter-select">
                        <!-- 동적으로 생성 -->
                    </select>
                </div>
            </div>
            <div class="yearly-filter-group">
                <label class="yearly-filter-label">작목상세:</label>
                <div class="yearly-filter-select-container">
                    <select id="yearlyCropSelect" class="yearly-filter-select">
                        <!-- 동적으로 생성 -->
                    </select>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- 모바일용 토글 버튼 -->
            <button class="mobile-toggle-btn" onclick="toggleYearlySidebar()">필터</button>
            
            <!-- 사이드바 (빈 공간 또는 향후 추가 필터용) -->
            <div class="sidebar" id="yearlySidebar" style="display: none;">
                <!-- 필터들이 상단으로 이동하여 사이드바는 숨김 처리 -->
            </div>

            <!-- 작목별 소득 표 (2열 1-2행) -->
            <div class="chart-card income-table">
                <div class="chart-header-with-filter">
                    <div class="chart-title" id="yearlyCropIncomeTitle">
                        평년 vs 현재 작목별 소득<button onclick="exportYearlyIncomeTableToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button>
                    </div>
                    <div class="filter-group">
                        <label for="yearlyCropGroupFilter">작목군:</label>
                        <select id="yearlyCropGroupFilter" onchange="updateYearlyCropIncomeTable()">
                            <option value="all">전체 작목군</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table class="summary-data-table">
                        <thead>
                            <tr>
                                <th class="sortable" data-sort="crop">작목 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="baseValue" id="yearlyIncomeBaseHeader">평년 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="compareValue" id="yearlyIncomeCompareHeader">현재 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="difference">차이 <span class="sort-arrow"></span></th>
                                <th class="sortable" data-sort="ratio">대비(%) <span class="sort-arrow"></span></th>
                            </tr>
                        </thead>
                        <tbody id="yearlyCropIncomeTableBody">
                            <tr><td colspan="5" class="loading">데이터를 불러오는 중...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 강원 평년 TOP 5 카드 (1열 1행) -->
            <div class="chart-card yearly-top5-card">
                <div class="filter-group yearly-top5-filter">
                    <label for="yearlyTop5CategoryFilter">항목:</label>
                    <select id="yearlyTop5CategoryFilter" onchange="updateYearlyTop5List()">
                        <option value="총수입">총수입</option>
                        <option value="경영비">경영비</option>
                        <option value="소득">소득</option>
                        <option value="소득률">소득률</option>
                        <option value="노동생산성">노동생산성</option>
                        <option value="자본생산성">자본생산성</option>
                        <option value="토지생산성">토지생산성</option>
                        <option value="kg당 생산비">kg당 생산비</option>
                    </select>
                </div>
                <div class="chart-title" id="yearlyTop5Title">
                    강원 평년 총수입 TOP 5
                </div>
                <div class="top5-container" id="yearlyTop5Container">
                    <div class="loading-item">데이터를 불러오는 중...</div>
                </div>
            </div>
            <!-- 전국 평년 TOP 5 카드 (1열 2행) -->
            <div class="chart-card yearly-national-top5-card">
                <div class="filter-group yearly-national-top5-filter">
                    <label for="yearlyNationalTop5CategoryFilter">항목:</label>
                    <select id="yearlyNationalTop5CategoryFilter" onchange="updateYearlyNationalTop5List()">
                        <option value="총수입">총수입</option>
                        <option value="경영비">경영비</option>
                        <option value="소득">소득</option>
                        <option value="소득률">소득률</option>
                        <option value="노동생산성">노동생산성</option>
                        <option value="자본생산성">자본생산성</option>
                        <option value="토지생산성">토지생산성</option>
                        <option value="kg당 생산비">kg당 생산비</option>
                    </select>
                </div>
                <div class="chart-title" id="yearlyNationalTop5Title">
                    전국 평년 총수입 TOP 5
                </div>
                <div class="top5-container" id="yearlyNationalTop5Container">
                    <div class="loading-item">데이터를 불러오는 중...</div>
                </div>
            </div>
            <!-- 분석표 영역 -->
            <div class="chart-card yearly-analysis-section">
                <div class="chart-title" id="yearlyAnalysisTitle">전국 전체 평년 대비 분석<button onclick="exportYearlyAnalysisToExcel()" class="excel-download-btn" title="엑셀 다운로드"></button></div>
                <div class="yearly-analysis-layout">
                    <div class="main-summary-box">
                        <div class="summary-item">
                            <span class="summary-label" id="yearlyBaseLabel">기준값</span>
                            <span id="yearlyBaseIncome">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label" id="yearlyCompareLabel">비교값</span>
                            <span id="yearlyCompareIncome">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">차이</span>
                            <span id="yearlyDifference">₩0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">대비</span>
                            <span id="yearlyRatio">0%</span>
                        </div>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead id="yearlyAnalysisTableHead">
                                <tr>
                                    <th>구분</th>
                                    <th>평년값</th>
                                    <th>현재값</th>
                                    <th>차이</th>
                                    <th>대비(%)</th>
                                </tr>
                            </thead>
                            <tbody id="yearlyAnalysisTableBody">
                                <tr><td colspan="5" class="loading">데이터를 불러오는 중...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showTab(tabName, ev) {
            // 탭 상태 업데이트
            if (typeof window.setCurrentTab === 'function') {
                window.setCurrentTab(tabName);
            }
            
            // 탭 컨텐츠 토글
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            const targetTab = document.getElementById(tabName);
            if (targetTab) targetTab.classList.add('active');

            // 탭 버튼 스타일 변경
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            // 이벤트가 있으면 클릭한 버튼을 active로, 없으면 해당 tabName을 가진 버튼 검색해서 처리
            if (ev && (ev.currentTarget || ev.target)) {
                const btn = ev.currentTarget || ev.target;
                btn.classList.add('active');
            } else {
                // fallback: 버튼의 onclick 텍스트를 검사해서 일치하는 버튼 찾아 active 추가
                const btn = Array.from(document.querySelectorAll('.tab-btn')).find(b => {
                    const onclick = b.getAttribute('onclick') || '';
                    return onclick.includes(`showTab('${tabName}')`) || onclick.includes(`showTab("${tabName}")`);
                });
                if (btn) btn.classList.add('active');
            }

            // 만약 'status' 또는 'compare' 탭을 열면 차트들이 보이도록 리사이즈/업데이트 시도
            if (tabName === 'status' || tabName === 'compare') {
                // 반응형 사이드바(모바일 토글) 재초기화(있다면)
                if (typeof initResponsiveSidebar === 'function') {
                    try { initResponsiveSidebar(); } catch(e) { /* 무시 */ }
                }

                // charts 전역 객체가 있으면 각 차트를 resize/update
                if (window.charts) {
                    Object.values(window.charts).forEach(chart => {
                        try {
                            // Chart.js 인스턴스이면 resize와 update 호출
                            if (chart && typeof chart.resize === 'function') {
                                chart.resize();
                                chart.update();
                            }
                        } catch (e) {
                            // 안전하게 무시
                            console.warn('차트 업데이트 중 오류:', e);
                        }
                    });
                }

                // 브라우저가 레이아웃을 재계산하도록 강제 resize 이벤트 발생 (추가 안전장치)
                setTimeout(() => window.dispatchEvent(new Event('resize')), 80);
            }
        }
    </script>


    <!-- JavaScript 파일 -->
    <script src="script.js"></script>
    
    <!-- Footer -->
    <footer class="data-source-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p class="source-title">출처 정보</p>
                <p class="source-text">출처: 농촌진흥청 「농산물소득조사」를 재가공한 자료로, 참고용으로 활용하시기 바랍니다.<br>
                자세한 사항은 농사로(https://www.nongsaro.go.kr) 및 통계청에서 확인하실 수 있습니다.</p>
            </div>
            
            <div class="footer-right">
                <p class="notice-title">이용 안내</p>
                <ul class="notice-list">
                    <li>수록된 자료는 단위 미만은 반올림 처리되었기 때문에, 합계와 비목(세부 항목)의 합이 일치하지 않을 수 있습니다.</li>
                    <li>2023년부터는 시설작물의 작형(촉성, 반촉성, 억제)이 통합되었으며, 수경·토경 형태별로 분리하여 조사하고 있습니다.</li>
                    <li>평년데이터는 2019~2023년 비목별 최대·최소값을 제외한 평균값입니다.</li>
                    <li>토지생산성 (원/10a) = 소득 / 면적(10a), 자본생산성 (원/원) = 소득 / 경영비, 노동생산성 (원/노동시간) = 소득/투입노동시간</li>
                    <li>kg당 경영비 (원/kg) = 경영비 / 주산물수량, kg당 생산비 (원/kg) = 생산비 / 주산물수량</li>
                    <li>자료 단위: 원/10a, kg/10a, 수취가격: 원/kg, %, 노지 풋옥수수 주산물 수량: 개/10a</li>
                </ul>
            </div>
        </div>
    </footer>
</body>
</html>